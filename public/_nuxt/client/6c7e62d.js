(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{1042:function(e,t,o){"use strict";o.r(t);var r=o(165),n=o(241),c=o(76),d=o(997),l=o(562),m=o(512),v=o(167),f=o(7),x=o(235),h=o(561),M=o(515),U=o(18),k=(o(52),o(36),o(210),o(111),o(6),o(15),o(77),o(110)),_={name:"",layout:"moderador",middleware:"esModerador",data:function(){return{tipoBusquedaCorreo:!0,tipoBusquedaNombreUsuario:!1,tipoBusquedaUID:!1,codigo:"buscaUnCorreo@gmail.com",datosUsuario:null,buscando:!1,roles:[{text:"Propietario",value:"propietario",selected:!1},{text:"Moderador",value:"moderador",selected:!1},{text:"Miembro",value:"miembro",selected:!1},{text:"Estudiante",value:"estudiante",selected:!1}],funcionesModerador:[{text:"Moderador de usuarios",value:"moderador-usuarios",selected:!1},{text:"Moderador de blogs",value:"moderador-blogs",selected:!1},{text:"Moderador de cursos",value:"moderador-cursos",selected:!1}],funcionesMiembro:[{text:"Instructor",value:"instructor",selected:!1},{text:"Blogger",value:"blogger",selected:!1}],esMiembro:!1,esModerador:!1,actualizandoRol:!1,actualizandoFuncionesModerador:!1,actualizandoFuncionesMiembro:!1,noExisteElUsuario:!1}},components:{VisualizadorDatosUsuario:o(773).default},watch:{tipoBusquedaCorreo:function(e,t){this.tipoBusquedaCorreo&&(this.codigo="buscaUnCorreo@gmail.com",this.tipoBusquedaNombreUsuario=!1,this.tipoBusquedaUID=!1)},tipoBusquedaNombreUsuario:function(e,t){this.tipoBusquedaNombreUsuario&&(this.codigo="",this.tipoBusquedaCorreo=!1,this.tipoBusquedaUID=!1)},tipoBusquedaUID:function(e,t){this.tipoBusquedaUID&&(this.codigo="",this.tipoBusquedaNombreUsuario=!1,this.tipoBusquedaCorreo=!1)}},methods:{vaciar:function(){this.datosUsuario=null,this.roles=[{text:"Propietario",value:"propietario",selected:!1},{text:"Moderador",value:"moderador",selected:!1},{text:"Miembro",value:"miembro",selected:!1},{text:"Estudiante",value:"estudiante",selected:!1}],this.funcionesMiembro=[{text:"Instructor",value:"instructor",selected:!1},{text:"Blogger",value:"blogger",selected:!1},{text:"Instructor Auxiliar",value:"instructor-auxiliar",selected:!1}],this.funcionesModerador=[{text:"Moderador de usuarios",value:"moderador-usuarios",selected:!1},{text:"Moderador de blogs",value:"moderador-blogs",selected:!1},{text:"Moderador de cursos",value:"moderador-cursos",selected:!1}],this.noExisteElUsuario=!1},buscar:function(){var e=this;return Object(U.a)(regeneratorRuntime.mark((function t(){var o,r,n,data,c,d,l,m,i,v,f,x,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.vaciar(),e.buscando=!0,o="",e.tipoBusquedaCorreo?o="correo":e.tipoBusquedaNombreUsuario?o="nombreUsuario":e.tipoBusquedaUID&&(o="uid"),!(r=e.$firebase.auth().currentUser)){t.next=12;break}return t.next=9,r.getIdToken();case 9:t.t0=t.sent,t.next=13;break;case 12:t.t0="";case 13:return r=t.t0,t.next=16,e.$store.dispatch("modules/usuarios/setTOKEN",r);case 16:return n={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}},t.next=19,e.$axios.$get("/serviceUsuario/moderador/obtenerUsuario/".concat(o,"/").concat(e.codigo),n);case 19:if(200===(data=t.sent).estado){t.next=24;break}return e.noExisteElUsuario=!0,e.buscando=!1,t.abrupt("return");case 24:if(e.datosUsuario=data.resultado,c=e.roles.findIndex((function(t){return t.value===e.datosUsuario.firestore.rol})),e.roles[c].selected=!0,"estudiante"===e.datosUsuario.firestore.rol){t.next=38;break}return t.next=30,k.b.firestore().collection("Miembros").doc(e.datosUsuario.firestore.uid).get();case 30:if(d=t.sent,e.esMiembro=d.exists,d.exists)for(l=d.data().funciones,m=function(i){var element=e.funcionesMiembro[i];l.find((function(e){return e===element.value}))&&(e.funcionesMiembro[i].selected=!0)},i=0;i<e.funcionesMiembro.length;i++)m(i);return t.next=35,k.b.firestore().collection("Moderadores").doc(e.datosUsuario.firestore.uid).get();case 35:if(v=t.sent,e.esModerador=v.exists,v.exists)for(f=v.data().funciones,x=function(t){var element=e.funcionesModerador[t];f.find((function(e){return e===element.value}))&&(e.funcionesModerador[t].selected=!0)},h=0;h<e.funcionesModerador.length;h++)x(h);case 38:t.next=45;break;case 40:return t.prev=40,t.t1=t.catch(0),t.next=44,e.$store.dispatch("modules/sistema/errorHandler",t.t1);case 44:t.sent;case 45:return t.prev=45,e.buscando=!1,t.finish(45);case 48:case"end":return t.stop()}}),t,null,[[0,40,45,48]])})))()},selectRol:function(e){for(var t=this.roles.findIndex((function(t){return t.value===e})),i=0;i<this.roles.length;i++)this.roles[i].selected=!1,t===i&&(this.roles[i].selected=!0)},selectFuncionMiembro:function(e){for(var t=this.funcionesMiembro.findIndex((function(t){return t.value===e})),i=0;i<this.funcionesMiembro.length;i++)t===i&&(this.funcionesMiembro[i].selected=!this.funcionesMiembro[i].selected)},selectFuncionModerador:function(e){for(var t=this.funcionesModerador.findIndex((function(t){return t.value===e})),i=0;i<this.funcionesModerador.length;i++)t===i&&(this.funcionesModerador[i].selected=!this.funcionesModerador[i].selected)},actualizarRol:function(){var e=this;return Object(U.a)(regeneratorRuntime.mark((function t(){var o,r,body,n,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.actualizandoRol=!0,!(o=e.$firebase.auth().currentUser)){t.next=9;break}return t.next=6,o.getIdToken();case 6:t.t0=t.sent,t.next=10;break;case 9:t.t0="";case 10:return o=t.t0,t.next=13,e.$store.dispatch("modules/usuarios/setTOKEN",o);case 13:return r=e.roles.filter((function(e){return!0===e.selected}))[0].value,body={rolNuevo:r},n={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}},c=e.datosUsuario.firestore.uid,t.next=19,e.$axios.$put("/serviceUsuario/propietario/actualizarRol/".concat(c),body,n);case 19:t.sent,(d=JSON.parse(JSON.stringify(e.datosUsuario))).firestore.rol=r,d.auth.customClaims.rol=r,e.datosUsuario=d,t.next=31;break;case 26:return t.prev=26,t.t1=t.catch(0),t.next=30,e.$store.dispatch("modules/sistema/errorHandler",t.t1);case 30:t.sent;case 31:return t.prev=31,e.actualizandoRol=!1,t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[0,26,31,34]])})))()},actualizarFuncionesModerador:function(){var e=this;return Object(U.a)(regeneratorRuntime.mark((function t(){var o,r,body,n,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.actualizandoFuncionesModerador=!0,!(o=e.$firebase.auth().currentUser)){t.next=9;break}return t.next=6,o.getIdToken();case 6:t.t0=t.sent,t.next=10;break;case 9:t.t0="";case 10:return o=t.t0,t.next=13,e.$store.dispatch("modules/usuarios/setTOKEN",o);case 13:return r=e.funcionesModerador.filter((function(e){return!0===e.selected})).map((function(e){return e.value})),body={funciones:r},n={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}},c=e.datosUsuario.firestore.uid,t.next=19,e.$axios.$put("/serviceUsuario/propietario/asignarFuncionesModerador/".concat(c),body,n);case 19:t.sent,t.next=27;break;case 22:return t.prev=22,t.t1=t.catch(0),t.next=26,e.$store.dispatch("modules/sistema/errorHandler",t.t1);case 26:t.sent;case 27:return t.prev=27,e.actualizandoFuncionesModerador=!1,t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[0,22,27,30]])})))()},actualizarFuncionesMiembro:function(){var e=this;return Object(U.a)(regeneratorRuntime.mark((function t(){var o,r,body,n,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.actualizandoFuncionesMiembro=!0,!(o=e.$firebase.auth().currentUser)){t.next=9;break}return t.next=6,o.getIdToken();case 6:t.t0=t.sent,t.next=10;break;case 9:t.t0="";case 10:return o=t.t0,t.next=13,e.$store.dispatch("modules/usuarios/setTOKEN",o);case 13:return r=e.funcionesMiembro.filter((function(e){return!0===e.selected})).map((function(e){return e.value})),body={funciones:r},n={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}},c=e.datosUsuario.firestore.uid,t.next=19,e.$axios.$put("/serviceUsuario/moderador/asignarFuncionesMiembro/".concat(c),body,n);case 19:t.sent,t.next=27;break;case 22:return t.prev=22,t.t1=t.catch(0),t.next=26,e.$store.dispatch("modules/sistema/errorHandler",t.t1);case 26:t.sent;case 27:return t.prev=27,e.actualizandoFuncionesMiembro=!1,t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[0,22,27,30]])})))()}}},C=o(32),component=Object(C.a)(_,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"mt-3"},[t(d.a,{staticClass:"mr-5",staticStyle:{display:"inline-block"},attrs:{label:"Correo",color:"#683bce","hide-details":""},model:{value:e.tipoBusquedaCorreo,callback:function(t){e.tipoBusquedaCorreo=t},expression:"tipoBusquedaCorreo"}}),e._v(" "),t(d.a,{staticClass:"mr-5",staticStyle:{display:"inline-block"},attrs:{label:"Nombre de usuario",color:"#683bce","hide-details":""},model:{value:e.tipoBusquedaNombreUsuario,callback:function(t){e.tipoBusquedaNombreUsuario=t},expression:"tipoBusquedaNombreUsuario"}}),e._v(" "),t(d.a,{staticClass:"mr-5",staticStyle:{display:"inline-block"},attrs:{label:"UID",color:"#683bce","hide-details":""},model:{value:e.tipoBusquedaUID,callback:function(t){e.tipoBusquedaUID=t},expression:"tipoBusquedaUID"}}),e._v(" "),t("div",{staticClass:"mt-3"},[e.tipoBusquedaCorreo?t(M.a,{attrs:{counter:100,label:"Correo del usuario"},model:{value:e.codigo,callback:function(t){e.codigo=t},expression:"codigo"}}):e.tipoBusquedaNombreUsuario?t(M.a,{attrs:{counter:20,label:"Nombre de usuario"},model:{value:e.codigo,callback:function(t){e.codigo=t},expression:"codigo"}}):e.tipoBusquedaUID?t(M.a,{attrs:{label:"UID del usuario"},model:{value:e.codigo,callback:function(t){e.codigo=t},expression:"codigo"}}):e._e(),e._v(" "),t(r.a,{staticClass:"mt-2",attrs:{outlined:"",rounded:"",text:"",color:"#683bce"},on:{click:e.buscar}},[e._v("\n                Buscar\n            ")])],1)],1),e._v(" "),t(m.a,{staticClass:"my-7"}),e._v(" "),e.buscando?t("div",[e._v("\n        Buscando..\n        "),t(x.a,{attrs:{indeterminate:"",color:"#683bce"}})],1):t("div",[e.datosUsuario?t("div",{staticClass:"container"},[t(h.a,[t(l.a,{attrs:{cols:"12",md:"8"}},[t("VisualizadorDatosUsuario",{attrs:{firestore:e.datosUsuario.firestore,auth:e.datosUsuario.auth}})],1),e._v(" "),t(l.a,{attrs:{cols:"12",md:"4"}},[e.datosUsuario.auth.disabled?t(r.a,{attrs:{block:"",outlined:"",color:"green",disabled:""}},[e._v("\n                        Habilitar\n                    ")]):t(r.a,{attrs:{block:"",outlined:"",rounded:"",text:"",color:"red",disabled:""}},[e._v("\n                        Deshabilitar\n                    ")]),e._v(" "),t(m.a,{staticClass:"my-5"}),e._v(" "),"propietario"===e.$store.state.modules.usuarios.rol?t(n.a,{staticClass:"mb-5",attrs:{loading:e.actualizandoRol,disabled:e.actualizandoRol}},[t(v.a,{attrs:{"three-line":""}},[t(f.a,[t("div",{staticClass:"text-overline mb-1"},[t("u",[e._v("Actualizar rol")])]),e._v(" "),t("div",{staticClass:"my-3"},e._l(e.roles,(function(o,n){return t(r.a,{key:n,staticClass:"ma-2",attrs:{dark:"",small:"",color:o.selected?"green":"#AFAFAF"},on:{click:function(t){return e.selectRol(o.value)}}},[e._v("\n                                        "+e._s(o.text)+"\n                                    ")])})),1)])],1),e._v(" "),t(m.a),e._v(" "),t(c.a,{staticClass:"ml-1"},[t(r.a,{attrs:{outlined:"",rounded:"",text:""},on:{click:e.actualizarRol}},[e._v("\n                                Actualizar\n                            ")])],1)],1):e._e(),e._v(" "),"propietario"===e.$store.state.modules.usuarios.rol&&e.esModerador?t(n.a,{staticClass:"mb-5",attrs:{loading:e.actualizandoFuncionesModerador,disabled:e.actualizandoFuncionesModerador}},[t(v.a,{attrs:{"three-line":""}},[t(f.a,[t("div",{staticClass:"text-overline mb-1"},[t("u",[e._v("Actualizar funciones de moderador")])]),e._v(" "),t("div",{staticClass:"my-3"},e._l(e.funcionesModerador,(function(o,n){return t(r.a,{key:n,staticClass:"ma-2",attrs:{dark:"",small:"",color:o.selected?"green":"#AFAFAF"},on:{click:function(t){return e.selectFuncionModerador(o.value)}}},[e._v("\n                                        "+e._s(o.text)+"\n                                    ")])})),1)])],1),e._v(" "),t(m.a),e._v(" "),t(c.a,{staticClass:"ml-1"},[t(r.a,{attrs:{outlined:"",rounded:"",text:""},on:{click:e.actualizarFuncionesModerador}},[e._v("\n                                Actualizar\n                            ")])],1)],1):e._e(),e._v(" "),"estudiante"!==e.datosUsuario.firestore.rol&&e.esMiembro?t(n.a,{staticClass:"mb-5",attrs:{loading:e.actualizandoFuncionesMiembro,disabled:e.actualizandoFuncionesMiembro}},[t(v.a,{attrs:{"three-line":""}},[t(f.a,[t("div",{staticClass:"text-overline mb-1"},[t("u",[e._v("Actualizar funciones de miembro")])]),e._v(" "),t("div",{staticClass:"my-3"},e._l(e.funcionesMiembro,(function(o,n){return t(r.a,{key:n,staticClass:"ma-2",attrs:{dark:"",small:"",color:o.selected?"green":"#AFAFAF"},on:{click:function(t){return e.selectFuncionMiembro(o.value)}}},[e._v("\n                                        "+e._s(o.text)+"\n                                    ")])})),1)])],1),e._v(" "),t(m.a),e._v(" "),t(c.a,{staticClass:"ml-1"},[t(r.a,{attrs:{outlined:"",rounded:"",text:""},on:{click:e.actualizarFuncionesMiembro}},[e._v("\n                                Actualizar\n                            ")])],1)],1):e._e()],1)],1)],1):e.noExisteElUsuario?t("div",[e._v("\n            No existe el usuario :(\n        ")]):t("div",[e._v("\n            Busca un usuario :)\n        ")])])],1)}),[],!1,null,null,null);t.default=component.exports}}]);