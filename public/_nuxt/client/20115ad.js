(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{1028:function(e,t,o){"use strict";o.r(t);var n=o(165),r=o(241),c=o(76),l=o(564),d=o(587),m=o(514),v=o(90),f=o(232),_=o(216),h=o(563),x=o(996),y=o(517),C=o(72),R=o(271),D=(o(49),o(34),o(56),o(48),o(28),o(10),o(63),o(67),o(51),o(18)),k=(o(52),o(36),o(111),o(6),o(359),o(110));o(799);function I(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return c=e.done,e},e:function(e){l=!0,r=e},f:function(){try{c||null==o.return||o.return()}finally{if(l)throw r}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var w=k.b.firestore(),S={name:"",middleware:"accesoAutenticado",data:function(){return{cargando:!0,pedidos:[],ultimoDoc:null,existeMas:!1,dialog:!1,dataDialog:null,vistaReembolso:[],procesandoReembolso:[],quieroReembolsar:[],cantidadAMostrar:5,cargandoPedidos:!1}},methods:{getFecha:function(e){return new Date(1e3*e).toLocaleString()},getFormaDePago:function(e){return"points"===e?"FP":""},generateLinkProducto:function(e,t,o){if("productos"===e&&"curso"===t)return"/curso/".concat(o.informacion.codigo)},cambiarVistaReembolso:function(e,t){var o=JSON.parse(JSON.stringify(this.vistaReembolso));o[e]=t,this.vistaReembolso=o},esValidoReembolsar:function(){var e=1e3*this.dataDialog.fechaCompra.seconds;return Date.now()<=e+2592e6},reembolsar:function(e){var t=this;return Object(D.a)(regeneratorRuntime.mark((function o(){var n,r,body,c,l,d,m,v,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if((n=JSON.parse(JSON.stringify(t.procesandoReembolso)))[e]=!0,t.procesandoReembolso=n,null,o.prev=4,!(r=t.$firebase.auth().currentUser)){o.next=12;break}return o.next=9,r.getIdToken();case 9:o.t0=o.sent,o.next=13;break;case 12:o.t0="";case 13:return r=o.t0,o.next=16,t.$store.dispatch("modules/usuarios/setTOKEN",r);case 16:return body={},c={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}},l=t.dataDialog.uid,d=t.dataDialog.detallesItems[e].uidItem,o.next=22,t.$axios.$put("/servicePedido/reembolsarProducto/".concat(l,"/").concat(d),body,c);case 22:m=o.sent,v=m.resultado,(f=t.pedidos.find((function(e){return e.uid===t.dataDialog.uid}))).cantidadReembolsado++,f.cantidadItems===f.cantidadReembolsado&&(f.todoReembolsado=!0),f.tieneReembolso=!0,t.$store.state.modules.usuarios.point+=t.dataDialog.detallesItems[e].precioTotal,t.dataDialog.detallesItems[e].fechaReembolsado={nanoseconds:v._nanoseconds,seconds:v._seconds},o.next=37;break;case 32:o.prev=32,o.t1=o.catch(4),console.log("error",o.t1),o.t1.response.data.mensajeCliente;case 37:return o.prev=37,n[e]=!1,t.procesandoReembolso=n,t.cambiarVistaReembolso(e,!1),o.finish(37);case 42:case"end":return o.stop()}}),o,null,[[4,32,37,42]])})))()},inicializarLista:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var o,n,r,c,l,d,m,v,f,_,h,x,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.cargando=!0,e.cargandoPedidos=!0,o=e.$store.state.modules.usuarios.uid,t.next=5,w.collection("Usuarios").doc(o).collection("Pedidos").where("estado","==","completado").where("tipoPedido","==","productos").orderBy("fechaCompra","desc").limit(e.cantidadAMostrar).get();case 5:if(!(n=t.sent).empty){t.next=10;break}return e.existeMas=!1,e.cargando=!1,t.abrupt("return");case 10:e.ultimoDoc=n.docs[n.docs.length-1],r=I(n.docs),t.prev=12,r.s();case 14:if((c=r.n()).done){t.next=48;break}return l=c.value,(d=l.data()).detallesItems=[],t.next=20,w.collection("Usuarios").doc(o).collection("Pedidos").doc(l.id).collection("DetallesItems").get();case 20:m=t.sent,v=0,f=I(m.docs),t.prev=23,f.s();case 25:if((_=f.n()).done){t.next=37;break}if(h=_.value,x=h.data(),d.detallesItems.push(x),"curso"!==x.tipoItem){t.next=34;break}return t.next=32,w.collection("CursosPublicado").doc(x.uidItem).get();case 32:y=t.sent,d.detallesItems[v].informacion=y.data();case 34:v++;case 35:t.next=25;break;case 37:t.next=42;break;case 39:t.prev=39,t.t0=t.catch(23),f.e(t.t0);case 42:return t.prev=42,f.f(),t.finish(42);case 45:e.pedidos.push(d);case 46:t.next=14;break;case 48:t.next=53;break;case 50:t.prev=50,t.t1=t.catch(12),r.e(t.t1);case 53:return t.prev=53,r.f(),t.finish(53);case 56:return t.next=58,e.verificarSiExisteMas();case 58:e.existeMas=t.sent,e.cargando=!1,e.cargandoPedidos=!1;case 61:case"end":return t.stop()}}),t,null,[[12,50,53,56],[23,39,42,45]])})))()},paginar:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var o,n,r,c,l,d,m,v,f,_,h,x,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.cargandoPedidos=!0,o=e.$store.state.modules.usuarios.uid,t.next=4,w.collection("Usuarios").doc(o).collection("Pedidos").where("estado","==","completado").where("tipoPedido","==","productos").orderBy("fechaCompra","desc").startAfter(e.ultimoDoc).limit(e.cantidadAMostrar).get();case 4:n=t.sent,e.ultimoDoc=n.docs[n.docs.length-1],r=I(n.docs),t.prev=7,r.s();case 9:if((c=r.n()).done){t.next=43;break}return l=c.value,(d=l.data()).detallesItems=[],t.next=15,w.collection("Usuarios").doc(o).collection("Pedidos").doc(l.id).collection("DetallesItems").get();case 15:m=t.sent,v=0,f=I(m.docs),t.prev=18,f.s();case 20:if((_=f.n()).done){t.next=32;break}if(h=_.value,x=h.data(),d.detallesItems.push(x),"curso"!==x.tipoItem){t.next=29;break}return t.next=27,w.collection("CursosPublicado").doc(x.uidItem).get();case 27:y=t.sent,d.detallesItems[v].informacion=y.data();case 29:v++;case 30:t.next=20;break;case 32:t.next=37;break;case 34:t.prev=34,t.t0=t.catch(18),f.e(t.t0);case 37:return t.prev=37,f.f(),t.finish(37);case 40:e.pedidos.push(d);case 41:t.next=9;break;case 43:t.next=48;break;case 45:t.prev=45,t.t1=t.catch(7),r.e(t.t1);case 48:return t.prev=48,r.f(),t.finish(48);case 51:return t.next=53,e.verificarSiExisteMas();case 53:e.existeMas=t.sent,e.cargandoPedidos=!1;case 55:case"end":return t.stop()}}),t,null,[[7,45,48,51],[18,34,37,40]])})))()},verificarSiExisteMas:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.$store.state.modules.usuarios.uid,t.next=3,w.collection("Usuarios").doc(o).collection("Pedidos").where("estado","==","completado").where("tipoPedido","==","productos").orderBy("fechaCompra","desc").startAfter(e.ultimoDoc).limit(1).get();case 3:return n=t.sent,t.abrupt("return",!n.empty);case 5:case"end":return t.stop()}}),t)})))()},abrirDialog:function(e){var t=this;return Object(D.a)(regeneratorRuntime.mark((function o(){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=t.pedidos.find((function(t){return t.uid===e})),t.dataDialog=n,t.vistaReembolso=Array(t.dataDialog.detallesItems.length).fill(!1),t.quieroReembolsar=Array(t.dataDialog.detallesItems.length).fill(""),t.procesandoReembolso=Array(t.dataDialog.detallesItems.length).fill(!1),t.dialog=!0;case 6:case"end":return o.stop()}}),o)})))()}},watch:{dialog:function(e,t){this.dialog||(this.dataDialog=null)}},created:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.inicializarLista();case 2:case"end":return t.stop()}}),t)})))()}},F=(o(800),o(32)),component=Object(F.a)(S,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[e.cargando?t("div",{staticClass:"text-center"},[t(_.a,{staticClass:"mt-15",attrs:{indeterminate:"",color:"green"}})],1):t("div",[t(x.a,{staticClass:"mt-5",scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",[t("th",{staticClass:"text-left"},[e._v("\n                            Nombre\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Tipo\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Fecha compra\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Precio total\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Tipo pago\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Cantidad reembolsado\n                        ")]),e._v(" "),t("th",{staticClass:"text-left"},[e._v("\n                            Acciones\n                        ")])])]),e._v(" "),t("tbody",e._l(e.pedidos,(function(o,r){return t("tr",{key:r},[t("td",[1===o.cantidadItems?t("div",["curso"===o.detallesItems[0].tipoItem?t("div",[e._v("\n                                    "+e._s(o.detallesItems[0].informacion.titulo)+"\n                                ")]):e._e()]):e._e()]),e._v(" "),t("td",[1===o.cantidadItems?t("div",["curso"===o.detallesItems[0].tipoItem?t("div",[e._v("\n                                    Curso\n                                ")]):e._e()]):t("div",[e._v("\n                                Varios\n                            ")])]),e._v(" "),t("td",[e._v(e._s(e.getFecha(o.fechaCompra.seconds)))]),e._v(" "),t("td",[e._v(e._s(o.costoTotal))]),e._v(" "),t("td",[e._v(e._s(e.getFormaDePago(o.datosPago.formaDePago)))]),e._v(" "),t("td",[e._v("\n                            "+e._s(o.cantidadReembolsado)+" / "+e._s(o.cantidadItems)+"\n                        ")]),e._v(" "),t("td",[t(n.a,{staticClass:"white--text my-1 mr-1",attrs:{fab:"",outlined:"",text:"",color:"green",title:"Detalles"},on:{click:function(t){return e.abrirDialog(o.uid)}}},[t(f.a,{attrs:{dark:""}},[e._v("\n                                    mdi-eye\n                                ")])],1)],1)])})),0)]},proxy:!0}])}),e._v(" "),t("div",{staticClass:"text-center mt-7"},[e.existeMas?t(n.a,{attrs:{loading:e.cargandoPedidos,outlined:"",text:"",color:"green"},on:{click:e.paginar}},[t(f.a,{attrs:{left:""}},[e._v("\n                    mdi-plus\n                ")]),e._v("\n                Cargar más\n            ")],1):e._e()],1)],1),e._v(" "),t(d.a,{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e.dataDialog?t(r.a,[t(C.a,{attrs:{dark:"",color:"green"}},[t(n.a,{attrs:{icon:"",dark:""},on:{click:function(t){e.dialog=!1}}},[t(f.a,[e._v("mdi-close")])],1),e._v(" "),t(R.b,[e._v("\n                    Detalles del pedido: "+e._s(e.dataDialog.uid)+"\n                ")])],1),e._v(" "),t("div",{staticClass:"pt-5 px-5"},[t(h.a,[t(l.a,{staticClass:"text-center",attrs:{cols:"12",md:"3"}},[t("div",{staticClass:"mb-7"},[t("h2",[e._v("Forma de pago")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.getFormaDePago(e.dataDialog.datosPago.formaDePago))+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Factura")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.dataDialog.tieneFactura?"Si":"No")+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Recibo")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.dataDialog.tieneRecibo?"Si":"No")+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Fecha del pedido")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.getFecha(e.dataDialog.fechaPedido.seconds))+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Fecha de la compra")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.getFecha(e.dataDialog.fechaCompra.seconds))+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Costo total")]),e._v(" "),t(m.a),e._v(" "),"productos"===e.dataDialog.tipoPedido?t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.dataDialog.costoTotal)+" FP\n                            ")]):t("p",{staticStyle:{display:"inline"}},[e._v("\n                                $"+e._s(e.dataDialog.costoTotal)+"\n                            ")])],1),e._v(" "),t("div",{staticClass:"mb-7"},[t("h2",[e._v("Reembolsos / Items")]),e._v(" "),t(m.a),e._v(" "),t("p",{staticStyle:{display:"inline"}},[e._v("\n                                "+e._s(e.dataDialog.cantidadReembolsado)+" / "+e._s(e.dataDialog.cantidadItems)+"\n                            ")])],1)]),e._v(" "),t(m.a,{attrs:{vertical:""}}),e._v(" "),t(l.a,{attrs:{cols:"12",md:"9"}},e._l(e.dataDialog.detallesItems,(function(o,l){return t(r.a,{key:l,staticClass:"mx-auto",attrs:{"max-width":"600"}},[t(c.c,["curso"===o.tipoItem?t("div",[t("p",{staticStyle:{display:"inline"}},[e._v("\n                                    Curso\n                                ")]),e._v(" "),t("p",{staticClass:"text-h4 text--primary"},[e._v("\n                                    "+e._s(o.informacion.titulo)+"\n                                ")])]):e._e(),e._v(" "),t("p",[e._v(" Cantidad de items: "+e._s(o.cantidad)+" ")]),e._v(" "),"productos"===e.dataDialog.tipoPedido?t("div",[o.detalles.porcentajeDescuento?t("p",{staticClass:"text--primary",staticStyle:{display:"inline"}},[e._v("\n                                    "+e._s(o.precioTotal)+" FP || "+e._s(o.detalles.precioReal)+" FP\n                                ")]):t("p",{staticClass:"text--primary",staticStyle:{display:"inline"}},[e._v("\n                                    Costo: "+e._s(o.precioTotal)+" FP\n                                ")])]):t("div",[o.detalles.porcentajeDescuento?t("p",{staticClass:"text--primary",staticStyle:{display:"inline"}},[e._v("\n                                    $"+e._s(o.precioTotal)+" || $"+e._s(o.detalles.precioReal)+"\n                                ")]):t("p",{staticClass:"text--primary",staticStyle:{display:"inline"}},[e._v("\n                                    Costo: $"+e._s(o.precioTotal)+"\n                                ")])])]),e._v(" "),t(c.a,[t(n.a,{attrs:{text:"",color:"green accent-4",to:e.generateLinkProducto(e.dataDialog.tipoPedido,o.tipoItem,o)}},[e._v("\n                                    Ver producto\n                                ")]),e._v(" "),o.fechaReembolsado?t(n.a,{attrs:{readonly:"",text:"",color:"accent-4"}},[e._v("\n                                    Reembolsado 💔\n                                ")]):e.esValidoReembolsar()?t(n.a,{attrs:{text:"",color:"red accent-4"},on:{click:function(t){return e.cambiarVistaReembolso(l,!0)}}},[e._v("\n                                    Reembolsar 😔\n                                ")]):e._e()],1),e._v(" "),t(v.a,[e.vistaReembolso[l]?t(r.a,{staticClass:"transition-fast-in-fast-out v-card--reveal",staticStyle:{height:"100%"}},[t(c.c,{staticClass:"pb-0"},[t("nuxt-link",{attrs:{to:""}},[t("p",{staticClass:"text-h6 text--primary"},[e._v("\n                                            ¿Qué ocurre si reembolso este producto?\n                                        ")])])],1),e._v(" "),t("div",{staticClass:"container textFieldReembolso"},[t(y.a,{attrs:{label:"Escribe: Quiero reembolsar"},model:{value:e.quieroReembolsar[l],callback:function(t){e.$set(e.quieroReembolsar,l,t)},expression:"quieroReembolsar[index]"}})],1),e._v(" "),t(c.a,{staticClass:"pt-0"},[t(n.a,{attrs:{loading:e.procesandoReembolso[l],disabled:"Quiero reembolsar"!==e.quieroReembolsar[l],text:"",color:"red accent-4"},on:{click:function(t){return e.reembolsar(l)}}},[e._v("\n                                        Si, quiero reembolsar\n                                    ")]),e._v(" "),t(n.a,{attrs:{text:"",color:"green accent-4"},on:{click:function(t){return e.cambiarVistaReembolso(l,!1)}}},[e._v("\n                                        Volver 😇\n                                    ")])],1)],1):e._e()],1)],1)})),1)],1)],1)],1):e._e()],1)],1)}),[],!1,null,"71d3cba8",null);t.default=component.exports},695:function(e,t,o){},800:function(e,t,o){"use strict";o(695)}}]);